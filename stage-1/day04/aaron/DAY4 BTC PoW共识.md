# BTC PoW 共识
### 步骤
1. 收集交易交易
比特币网络中的矿工节点会持续收集全网中未被确认的交易，将这些交易筛选后纳入自己待打包的候选区块中。随后，矿工按照 Merkle 树算法对交易数据进行处理，通过两两哈希、层层归约的方式，最终计算出一个唯一的 Merkle 根哈希值。这个哈希值相当于当前区块内所有交易的 “数据摘要”，能快速验证交易数据是否被篡改。
2. 组装区块头
矿工将上一步得到的 Merkle 根，与其他关键信息共同组装成区块头，区块头包含 6 类关键信息：区块版本号、前一个区块的哈希值、Merkle 根、时间戳、当前网络的难度目标以及随机数（Nonce）。其中前一区块的哈希值是保障区块链连续性的关键，能让新区块与主链紧密衔接。
3. 算力竞争解算哈希难题
矿工开始通过算力竞争解算核心数学难题，计算出的哈希值必须小于网络设定的难度目标值nonce。由于哈希算法的不可逆性，矿工只能靠暴力枚举的方式尝试随机数，这个过程会消耗大量算力。
4. 广播有效区块
当某一名矿工率先找到符合难度目标的随机数，就意味着完成了工作量证明，同时获得该区块的记账权。随后，这名矿工立刻将打包好的完整区块（包含区块头和区块体的交易数据）向全网所有节点广播，同步自己的记账结果。
5. 全网节点验证区块有效性
其他节点收到广播后，会快速开展双重验证。一方面验证区块内的交易是否合法，比如交易对应的 UTXO 是否为未花费状态、签名是否有效等；另一方面验证该区块头计算出的哈希值是否符合当前难度目标。验证不通过的区块会被直接丢弃，矿工此前的算力消耗也会白费。
6. 区块上链并开启下一轮竞争
当全网多数节点确认区块有效后，该区块会被正式追加到比特币主链的末端。成功记账的矿工将获得对应的奖励，包括固定的区块奖励和区块内所有交易的手续费。与此同时，全网所有矿工停止当前区块的竞争，以刚上链的新区块为基础，重复上述步骤，开启下一个区块的 PoW 竞争流程。

### 产生的问题
1. 算力浪费
需要暴力枚举尝试，造成算力浪费

2. 算力中心化风险
挖矿已从早期个人电脑挖矿，演变为专业矿机、大型矿场的集中化挖矿模式。少数矿池掌控着全网大量算力，虽未达到 51% 攻击阈值，但算力集中违背了去中心化初衷，可能导致矿池对网络规则的话语权过大，影响网络公平性。

3. 网络拥堵
为维持去中心化和安全性，比特币网络平均 10 分钟出块，每个区块容量约 1MB，导致每秒仅能处理 7 笔左右交易。这一性能远低于传统支付系统（如 Visa 每秒数千笔），无法满足大规模商业场景的高效支付需求，还会引发交易拥堵和手续费上涨

4. 分叉
两个矿工同时出块。会按照最长链原则

5. 双花
一笔费用花两次

### BTC如何解决
最长链/概率最终性：默认最长链有效

合理合规的区块与脚本限制：限制脚本复杂度/签名数、标准中继策略，防 DoS。

难度调整：每 2016 块（约两周）自动调节难度，目标平均 10 分钟/块。